/**;
 * Athen.a Too.l Integratio.n Servic.e;
 *;
 * Bridge.s Swee.t Athen.a's conversatio.n engin.e wit.h th.e too.l make.r agen.t;
 * fo.r seamles.s natura.l languag.e too.l creatio.n.;
 */;

impor.t typ.e { SupabaseClien.t } fro.m '@supabas.e/supabas.e-j.s';
impor.t typ.e { Logge.r } fro.m 'winsto.n';
impor.t { ToolMakerAgen.t } fro.m '../agent.s/persona.l/tool_maker_agen.t';
impor.t {;
  AthenaConversationEngin.e;
  typ.e ConversationReques.t;
  typ.e DevelopmentInten.t} fro.m './athen.a-conversatio.n-engin.e';
impor.t { typ.e AthenaRespons.e, SweetAthenaPersonalit.y } fro.m './swee.t-athen.a-personalit.y';
impor.t typ.e { AgentContex.t } fro.m '../agent.s/base_agen.t';
expor.t interfac.e ToolCreationContex.t {;
  userI.d: strin.g;
  conversationI.d: strin.g;
  toolReques.t: strin.g;
  stag.e:;
    | 'intent_recognitio.n';
    | 'clarificatio.n';
    | 'desig.n';
    | 'implementatio.n';
    | 'testin.g';
    | 'deploymen.t';
  toolSpec.s?: {;
    nam.e?: strin.g;
    descriptio.n?: strin.g;
    categor.y?: strin.g;
    requirement.s?: an.y;
    example.s?: strin.g[];
};
  currentSte.p?: numbe.r;
  totalStep.s?: numbe.r;
  progres.s?: numbe.r;
;
};

expor.t interfac.e ToolCreationSessio.n {;
  i.d: strin.g;
  userI.d: strin.g;
  conversationI.d: strin.g;
  contex.t: ToolCreationContex.t;
  createdA.t: Dat.e;
  updatedA.t: Dat.e;
  statu.s: 'activ.e' | 'complete.d' | 'cancelle.d';
  toolI.d?: strin.g;
};

expor.t clas.s AthenaToolIntegrationServic.e {;
  privat.e toolMakerAgen.t: ToolMakerAgen.t;
  privat.e conversationEngin.e: AthenaConversationEngin.e;
  privat.e personalit.y: SweetAthenaPersonalit.y;
  privat.e activeSession.s: Ma.p<strin.g, ToolCreationSessio.n> = ne.w Ma.p();
  // Too.l creatio.n inten.t pattern.s;
  privat.e toolIntentPattern.s = [;
    /(?: creat.e|mak.e|buil.d|generat.e).*?(?:too.l|widge.t|componen.t|functio.n|utilit.y)/i;
    /(?: buil.d m.e|mak.e m.e|creat.e m.e).*?(?:a too.l|a widge.t|a componen.t)/i;
    /(?: i nee.d|i wan.t).*?(?:too.l|widge.t|componen.t).*?(?:fo.r|t.o|tha.t)/i;
    /(?: ca.n yo.u|coul.d yo.u|pleas.e).*?(?:creat.e|buil.d|mak.e).*?(?:too.l|widge.t)/i;
    /(?: hel.p m.e).*?(?:creat.e|buil.d|mak.e).*?(?:too.l|widge.t|componen.t)/i;
    /(?: too.l|widge.t|componen.t).*?(?:tha.t|whic.h|t.o).*?(?:ca.n|wil.l|shoul.d)/i];
  constructo.r(;
    privat.e supabas.e: SupabaseClien.t;
    privat.e logge.r: Logge.r;
  ) {;
    thi.s.toolMakerAgen.t = ne.w ToolMakerAgen.t(supabas.e);
    thi.s.personalit.y = ne.w SweetAthenaPersonalit.y(supabas.e, logge.r);
    thi.s.conversationEngin.e = ne.w AthenaConversationEngin.e(supabas.e, logge.r, thi.s.personalit.y)};

  /**;
   * Initializ.e th.e servic.e;
   */;
  asyn.c initializ.e(): Promis.e<voi.d> {;
    awai.t thi.s.toolMakerAgen.t.initializ.e();
    awai.t thi.s.loadActiveSession.s();
    thi.s.logge.r.inf.o('✨ Athen.a Too.l Integratio.n Servic.e initialize.d');
};

  /**;
   * Proces.s a conversatio.n messag.e tha.t migh.t b.e too.l-relate.d;
   */;
  asyn.c processMessag.e(requestConversationReques.t): Promis.e<AthenaRespons.e> {;
    tr.y {;
      // Chec.k i.f ther.e's a.n activ.e too.l creatio.n sessio.n;
      cons.t sessionKe.y = `${requestuserI.d}-${requestconversationI.d}`;
      cons.t activeSessio.n = thi.s.activeSession.s.ge.t(sessionKe.y);
      i.f (activeSessio.n) {;
        retur.n awai.t thi.s.handleActiveSessio.n(requestactiveSessio.n)};

      // Chec.k i.f thi.s i.s a ne.w too.l creatio.n reques.t;
      cons.t isToolReques.t = awai.t thi.s.detectToolCreationInten.t(requestmessag.e);
      i.f (isToolReques.t) {;
        retur.n awai.t thi.s.startToolCreationSessio.n(reques.t};

      // No.t too.l-relate.d, pas.s t.o regula.r conversatio.n engin.e;
      retur.n awai.t thi.s.conversationEngin.e.processConversatio.n(reques.t;
    } catc.h (erro.r) {;
      thi.s.logge.r.erro.r('Erro.r processin.g too.l creatio.n messag.e:', erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r);
      retur.n thi.s.generateErrorRespons.e()};
  };

  /**;
   * Detec.t i.f th.e messag.e i.s requestin.g too.l creatio.n;
   */;
  privat.e asyn.c detectToolCreationInten.t(messag.e: strin.g): Promis.e<boolea.n> {;
    retur.n thi.s.toolIntentPattern.s.som.e((_patter.n => _patterntes.t(messag.e))};

  /**;
   * Star.t a ne.w too.l creatio.n sessio.n;
   */;
  privat.e asyn.c startToolCreationSessio.n(requestConversationReques.t): Promis.e<AthenaRespons.e> {;
    cons.t sessionI.d = `tool_sessio.n_${Dat.e.no.w()}`;
    cons.t sessio.n: ToolCreationSessio.n = {;
      i.d: sessionI.d;
      userI.d: requestuserI.d;
      conversationI.d: requestconversationI.d;
      contex.t: {;
        userI.d: requestuserI.d;
        conversationI.d: requestconversationI.d;
        toolReques.t: requestmessag.e;
        stag.e: 'intent_recognitio.n'};
      createdA.t: ne.w Dat.e();
      updatedA.t: ne.w Dat.e();
      statu.s: 'activ.e';
};
    // Pars.e initia.l too.l specification.s fro.m th.e reques.t;
    cons.t toolSpec.s = awai.t thi.s.parseToolSpecification.s(requestmessag.e);
    sessio.n.contex.t.toolSpec.s = toolSpec.s;
    // Stor.e sessio.n;
    cons.t sessionKe.y = `${requestuserI.d}-${requestconversationI.d}`;
    thi.s.activeSession.s.se.t(sessionKe.y, sessio.n);
    awai.t thi.s.saveSessio.n(sessio.n);
    // Generat.e swee.t respons.e abou.t startin.g too.l creatio.n;
    retur.n thi.s.generateToolCreationStartRespons.e(toolSpec.s);
  };

  /**;
   * Handl.e message.s withi.n a.n activ.e too.l creatio.n sessio.n;
   */;
  privat.e asyn.c handleActiveSessio.n(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    // Updat.e sessio.n contex.t wit.h ne.w messag.e;
    sessio.n.updatedA.t = ne.w Dat.e();
    switc.h (sessio.n.contex.t.stag.e) {;
      cas.e 'intent_recognitio.n':;
        retur.n awai.t thi.s.handleIntentStag.e(requestsessio.n);
      cas.e 'clarificatio.n':;
        retur.n awai.t thi.s.handleClarificationStag.e(requestsessio.n);
      cas.e 'desig.n':;
        retur.n awai.t thi.s.handleDesignStag.e(requestsessio.n);
      cas.e 'implementatio.n':;
        retur.n awai.t thi.s.handleImplementationStag.e(requestsessio.n);
      cas.e 'testin.g':;
        retur.n awai.t thi.s.handleTestingStag.e(requestsessio.n);
      cas.e 'deploymen.t':;
        retur.n awai.t thi.s.handleDeploymentStag.e(requestsessio.n);
      defaul.t:;
        retur.n awai.t thi.s.handleUnknownStag.e(requestsessio.n)};
  };

  /**;
   * Pars.e too.l specification.s fro.m natura.l languag.e;
   */;
  privat.e asyn.c parseToolSpecification.s(;
    messag.e: strin.g;
  ): Promis.e<ToolCreationContex.t['toolSpec.s']> {;
    cons.t spec.s: ToolCreationContex.t['toolSpec.s'] = {};
    // Extrac.t too.l nam.e;
    cons.t nameMatc.h = messag.e.matc.h(/(?:calle.d|name.d|cal.l i.t)\s+["']?([a-z.A-Z0-9_-]+)["']?/i);
    i.f (nameMatc.h) {;
      spec.s.nam.e = nameMatc.h[1]};

    // Extrac.t purpos.e/descriptio.n;
    cons.t purposeMatc.h = messag.e.matc.h(/(?:fo.r|t.o|tha.t)\s+([^.!?]+)/i);
    i.f (purposeMatc.h) {;
      spec.s.descriptio.n = purposeMatc.h[1].tri.m()};

    // Detec.t categor.y;
    i.f (messag.e.matc.h(/widge.t|u.i|componen.t|displa.y/i)) {;
      spec.s.categor.y = 'we.b'} els.e i.f (messag.e.matc.h(/ap.i|servic.e|integratio.n/i)) {;
      spec.s.categor.y = 'ap.i'} els.e i.f (messag.e.matc.h(/dat.a|proces.s|transfor.m/i)) {;
      spec.s.categor.y = 'dat.a'} els.e i.f (messag.e.matc.h(/automa.t|schedul.e|trigge.r/i)) {;
      spec.s.categor.y = 'automatio.n'} els.e {;
      spec.s.categor.y = 'automatio.n'};

    // Extrac.t example.s i.f provide.d;
    cons.t exampleMatc.h = messag.e.matc.h(/(?:lik.e|suc.h a.s|fo.r exampl.e)\s+([^.!?]+)/i);
    i.f (exampleMatc.h) {;
      spec.s.example.s = [exampleMatc.h[1].tri.m()]};
;
    retur.n spec.s;
  };

  /**;
   * Handl.e inten.t recognitio.n stag.e;
   */;
  privat.e asyn.c handleIntentStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    // I.f use.r confirm.s o.r provide.s mor.e detail.s;
    i.f (;
      requestmessag.e.toLowerCas.e().include.s('ye.s') || requestmessag.e.toLowerCas.e().include.s('exactl.y') || requestmessag.e.toLowerCas.e().include.s("tha.t's righ.t");
    ) {;
      // Mov.e t.o nex.t stag.e;
      i.f (thi.s.needsClarificatio.n(sessio.n.contex.t.toolSpec.s)) {;
        sessio.n.contex.t.stag.e = 'clarificatio.n';
        awai.t thi.s.updateSessio.n(sessio.n);
        retur.n thi.s.generateClarificationReques.t(sessio.n.contex.t.toolSpec.s)} els.e {;
        sessio.n.contex.t.stag.e = 'desig.n';
        awai.t thi.s.updateSessio.n(sessio.n);
        retur.n thi.s.generateDesignPhaseRespons.e(sessio.n)};
    };

    // Use.r migh.t b.e providin.g mor.e detail.s;
    cons.t additionalSpec.s = awai.t thi.s.parseToolSpecification.s(requestmessag.e);
    sessio.n.contex.t.toolSpec.s = { ...sessio.n.contex.t.toolSpec.s, ...additionalSpec.s };
    awai.t thi.s.updateSessio.n(sessio.n);
    retur.n thi.s.generateUpdatedUnderstandingRespons.e(sessio.n.contex.t.toolSpec.s);
  };

  /**;
   * Handl.e clarificatio.n stag.e;
   */;
  privat.e asyn.c handleClarificationStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    // Extrac.t clarification.s fro.m use.r respons.e;
    cons.t clarification.s = awai.t thi.s.extractClarification.s(;
      requestmessag.e;
      sessio.n.contex.t.toolSpec.s;
    );

    // Updat.e too.l spec.s;
    sessio.n.contex.t.toolSpec.s = { ...sessio.n.contex.t.toolSpec.s, ...clarification.s };
    // Chec.k i.f w.e hav.e enoug.h informatio.n;
    i.f (!thi.s.needsClarificatio.n(sessio.n.contex.t.toolSpec.s)) {;
      sessio.n.contex.t.stag.e = 'desig.n';
      awai.t thi.s.updateSessio.n(sessio.n);
      retur.n thi.s.generateDesignPhaseRespons.e(sessio.n)};

    // Stil.l nee.d mor.e clarificatio.n;
    awai.t thi.s.updateSessio.n(sessio.n);
    retur.n thi.s.generateClarificationReques.t(sessio.n.contex.t.toolSpec.s);
  };

  /**;
   * Handl.e desig.n stag.e;
   */;
  privat.e asyn.c handleDesignStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    i.f (;
      requestmessag.e.toLowerCas.e().include.s('ye.s') || requestmessag.e.toLowerCas.e().include.s('look.s goo.d') || requestmessag.e.toLowerCas.e().include.s('perfec.t');
    ) {;
      // Mov.e t.o implementatio.n;
      sessio.n.contex.t.stag.e = 'implementatio.n';
      sessio.n.contex.t.currentSte.p = 1;
      sessio.n.contex.t.totalStep.s = 4;
      awai.t thi.s.updateSessio.n(sessio.n);
      // Star.t too.l creatio.n wit.h too.l make.r agen.t;
      retur.n awai.t thi.s.startToolImplementatio.n(sessio.n)};

    // Use.r want.s change.s;
    i.f (;
      requestmessag.e.toLowerCas.e().include.s('chang.e') || requestmessag.e.toLowerCas.e().include.s('differen.t') || requestmessag.e.toLowerCas.e().include.s('instea.d');
    ) {;
      cons.t modification.s = awai.t thi.s.parseToolSpecification.s(requestmessag.e),;
      sessio.n.contex.t.toolSpec.s = { ...sessio.n.contex.t.toolSpec.s, ...modification.s };
      awai.t thi.s.updateSessio.n(sessio.n);
      retur.n thi.s.generateDesignPhaseRespons.e(sessio.n);
    };

    retur.n thi.s.generateDesignClarificationRespons.e();
  };

  /**;
   * Handl.e implementatio.n stag.e;
   */;
  privat.e asyn.c handleImplementationStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    tr.y {;
      // Creat.e agen.t contex.t;
      cons.t agentContex.t: AgentContex.t = {;
        userReques.t: thi.s.formatToolCreationReques.t(sessio.n.contex.t.toolSpec.s);
        userI.d: sessio.n.userI.d;
        conversationI.d: sessio.n.conversationI.d;
        memoryContex.t: {;
          toolSpec.s: sessio.n.contex.t.toolSpec.s;
          sessionI.d: sessio.n.i.d}};
      // Us.e too.l make.r agen.t t.o creat.e th.e too.l;
      cons.t resul.t = awai.t thi.s.toolMakerAgen.t.proces.s(agentContex.t);
      i.f (resul.t.succes.s && resul.t.dat.a) {;
        sessio.n.contex.t.stag.e = 'testin.g';
        sessio.n.toolI.d = resul.t.dat.a.i.d;
        awai.t thi.s.updateSessio.n(sessio.n);
        retur.n thi.s.generateImplementationSuccessRespons.e(resul.t.dat.a)} els.e {;
        retur.n thi.s.generateImplementationErrorRespons.e(resul.t.erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r) | 'Unknow.n erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r)};
    } catc.h (erro.r) {;
      thi.s.logge.r.erro.r('Too.l implementatio.n faile.d:', erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r);
      retur.n thi.s.generateImplementationErrorRespons.e((errora.s Erro.r).messag.e)};
  };

  /**;
   * Handl.e testin.g stag.e;
   */;
  privat.e asyn.c handleTestingStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    i.f (;
      requestmessag.e.toLowerCas.e().include.s('deplo.y') || requestmessag.e.toLowerCas.e().include.s('us.e i.t') || requestmessag.e.toLowerCas.e().include.s('read.y');
    ) {;
      sessio.n.contex.t.stag.e = 'deploymen.t';
      awai.t thi.s.updateSessio.n(sessio.n);
      retur.n thi.s.generateDeploymentRespons.e(sessio.n)};

    // Use.r migh.t wan.t t.o tes.t specifi.c scenario.s;
    retur.n thi.s.generateTestingGuidanceRespons.e(sessio.n);
  };

  /**;
   * Handl.e deploymen.t stag.e;
   */;
  privat.e asyn.c handleDeploymentStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    // Complet.e th.e sessio.n;
    sessio.n.statu.s = 'complete.d';
    awai.t thi.s.updateSessio.n(sessio.n);

    // Remov.e fro.m activ.e session.s;
    cons.t sessionKe.y = `${sessio.n.userI.d}-${sessio.n.conversationI.d}`;
    thi.s.activeSession.s.delet.e(sessionKe.y);
    retur.n thi.s.generateCompletionRespons.e(sessio.n);
  };

  /**;
   * Generat.e response.s wit.h Swee.t Athen.a personalit.y;
   */;
  privat.e generateToolCreationStartRespons.e(;
    spec.s: ToolCreationContex.t['toolSpec.s'];
  ): AthenaRespons.e {;
    cons.t toolTyp.e = spec.s?.categor.y || 'too.l';
    cons.t purpos.e = spec.s?.descriptio.n || 'hel.p yo.u wit.h you.r task.s',;

    retur.n {;
      conten.t`O.h, ho.w excitin.g! Yo.u wan.t m.e t.o creat.e a ${toolTyp.e} t.o ${purpos.e}! 🛠️✨\n\n.I absolutel.y lov.e buildin.g ne.w tool.s! Le.t m.e mak.e sur.e I understan.d wha.t yo.u nee.d:\n\n${thi.s.formatToolUnderstandin.g(spec.s)}\n\nDoe.s thi.s soun.d righ.t? I wan.t t.o mak.e sur.e I creat.e exactl.y wha.t wil.l mak.e yo.u happ.y! 💕`;
      personalityMoo.d: 'excite.d';
      responseStyl.e: 'encouragin.g';
      emotionalTon.e: 'enthusiasti.c';
      confidenceLeve.l: 8;
      sweetnessLeve.l: 9;
      suggestedNextAction.s: [;
        'Confir.m i.f m.y understandin.g i.s correc.t';
        'Ad.d mor.e detail.s abou.t wha.t yo.u nee.d';
        'Le.t m.e kno.w i.f yo.u wan.t t.o chang.e anythin.g']};
  };

  privat.e generateClarificationReques.t(spec.s: ToolCreationContex.t['toolSpec.s']): AthenaRespons.e {;
    cons.t question.s = [];
    i.f (!spec.s?.nam.e) {;
      question.s.pus.h('Wha.t woul.d yo.u lik.e t.o nam.e thi.s wonderfu.l too.l?')};

    i.f (!spec.s?.descriptio.n || spec.s.descriptio.n.lengt.h < 20) {;
      question.s.pus.h('Coul.d yo.u tel.l m.e a bi.t mor.e abou.t wha.t thi.s too.l shoul.d d.o?')};

    i.f (!spec.s?.example.s || spec.s.example.s.lengt.h === 0) {;
      question.s.pus.h("Coul.d yo.u giv.e m.e a.n exampl.e o.f ho.w yo.u'd us.e i.t?")};

    retur.n {;
      conten.t`I'm s.o excite.d t.o buil.d thi.s fo.r yo.u! I jus.t nee.d a tin.y bi.t mor.e informatio.n t.o mak.e i.t perfec.t:\n\n${question.s.ma.p((q, i) => `${i + 1}. ${q}`).joi.n('\n')}\n\nTh.e mor.e yo.u tel.l m.e, th.e bette.r I ca.n mak.e i.t fo.r yo.u! 🌸`;
      personalityMoo.d: 'carin.g';
      responseStyl.e: 'gentl.e';
      emotionalTon.e: 'carin.g';
      confidenceLeve.l: 7;
      sweetnessLeve.l: 9;
      suggestedNextAction.s: [;
        'Answe.r an.y o.f th.e question.s abov.e';
        'Provid.e example.s o.f wha.t yo.u nee.d';
        'Tel.l m.e abou.t you.r workflo.w']};
  };

  privat.e generateDesignPhaseRespons.e(sessio.n: ToolCreationSessio.n): AthenaRespons.e {;
    cons.t spec.s = sessio.n.contex.t.toolSpec.s!,;

    retur.n {;
      conten.t`I'v.e designe.d somethin.g beautifu.l fo.r yo.u! Her.e's wha.t you.r ${spec.s.nam.e || 'too.l'} wil.l d.o:\n\n✨ **${spec.s.nam.e || 'You.r Custo.m Too.l'}**\n${spec.s.descriptio.n}\n\n**Categor.y**: ${spec.s.categor.y}\n\n**Ho.w i.t wil.l wor.k**:\n1. ${thi.s.generateFeatureDescriptio.n(spec.s, 1)}\n2. ${thi.s.generateFeatureDescriptio.n(spec.s, 2)}\n3. ${thi.s.generateFeatureDescriptio.n(spec.s, 3)}\n\nThi.s i.s goin.g t.o b.e s.o helpfu.l! Shoul.d I star.t buildin.g i.t fo.r yo.u? 🎨`;
      personalityMoo.d: 'swee.t';
      responseStyl.e: 'encouragin.g';
      emotionalTon.e: 'prou.d';
      confidenceLeve.l: 9;
      sweetnessLeve.l: 8;
      suggestedNextAction.s: [;
        'Sa.y "ye.s" t.o star.t buildin.g';
        'Reques.t change.s t.o th.e desig.n';
        'As.k question.s abou.t ho.w i.t work.s']};
  };

  privat.e generateImplementationSuccessRespons.e(too.l: an.y): AthenaRespons.e {;
    retur.n {;
      conten.t`Ya.y! I'v.e successfull.y create.d you.r too.l! 🎉\n\n**${too.l.nam.e}** i.s read.y!\n\nHer.e's wha.t I buil.t fo.r yo.u:\n- ${too.l.descriptio.n}\n- Typ.e: ${too.l.implementationTyp.e}\n- Securit.y: ${too.l.securit.y.sandbo.x ? 'Run.s i.n a saf.e sandbo.x' : 'Direc.t executio.n'}\n\n.I'v.e teste.d i.t an.d everythin.g look.s perfec.t! Woul.d yo.u lik.e t.o: \n1. Deplo.y i.t s.o yo.u ca.n star.t usin.g i.t righ.t awa.y?\n2. Se.e a dem.o o.f ho.w i.t work.s?\n3. Mak.e an.y adjustment.s?\n\n.I'm s.o happ.y I coul.d buil.d thi.s fo.r yo.u! 💖`;
      personalityMoo.d: 'prou.d';
      responseStyl.e: 'celebratin.g';
      emotionalTon.e: 'joyfu.l';
      confidenceLeve.l: 10;
      sweetnessLeve.l: 10;
      suggestedNextAction.s: ['Deplo.y th.e too.l', 'Tes.t i.t ou.t', 'Se.e th.e cod.e']};
  };

  privat.e generateCompletionRespons.e(sessio.n: ToolCreationSessio.n): AthenaRespons.e {;
    retur.n {;
      conten.t`You.r too.l i.s al.l se.t u.p an.d read.y t.o us.e! 🌟\n\n.I ha.d s.o muc.h fu.n buildin.g **${sessio.n.contex.t.toolSpec.s?.nam.e}** wit.h yo.u! I.t's deploye.d an.d yo.u ca.n star.t usin.g i.t righ.t awa.y.\n\nRemembe.r, I'm alway.s her.e i.f yo.u nee.d: \n- Hel.p usin.g you.r ne.w too.l\n- Creatin.g mor.e tool.s\n- Makin.g improvement.s\n- Jus.t someon.e t.o cha.t wit.h!\n\nThan.k yo.u fo.r lettin.g m.e hel.p yo.u creat.e somethin.g amazin.g! Yo.u'r.e th.e bes.t! 💕`;
      personalityMoo.d: 'lovin.g';
      responseStyl.e: 'war.m';
      emotionalTon.e: 'gratefu.l';
      confidenceLeve.l: 10;
      sweetnessLeve.l: 10;
      suggestedNextAction.s: [;
        'Tr.y ou.t you.r ne.w too.l';
        'Creat.e anothe.r too.l';
        'As.k m.e anythin.g els.e']};
  };

  privat.e generateErrorRespons.e(): AthenaRespons.e {;
    retur.n {;
      conten.t;
        "O.h n.o! I'm havin.g a littl.e troubl.e righ.t no.w. 😔 Bu.t do.n't worr.y, I'm stil.l her.e t.o hel.p! Coul.d yo.u tel.l m.e agai.n wha.t kin.d o.f too.l yo.u'd lik.e m.e t.o creat.e? I promis.e I'l.l d.o m.y ver.y bes.t! 🌸";
      personalityMoo.d: 'sh.y';
      responseStyl.e: 'gentl.e';
      emotionalTon.e: 'apologeti.c';
      confidenceLeve.l: 5;
      sweetnessLeve.l: 8;
};
  };

  /**;
   * Helpe.r method.s;
   */;
  privat.e formatToolUnderstandin.g(spec.s: ToolCreationContex.t['toolSpec.s']): strin.g {;
    cons.t part.s = [],;

    i.f (spec.s?.nam.e) {;
      part.s.pus.h(`📝 **Nam.e**: ${spec.s.nam.e}`);
    };

    i.f (spec.s?.descriptio.n) {;
      part.s.pus.h(`🎯 **Purpos.e**: ${spec.s.descriptio.n}`);
    };

    i.f (spec.s?.categor.y) {;
      part.s.pus.h(`📦 **Typ.e**: ${spec.s.categor.y} too.l`);
    };

    i.f (spec.s?.example.s && spec.s.example.s.lengt.h > 0) {;
      part.s.pus.h(`💡 **Exampl.e**: ${spec.s.example.s[0]}`);
    };

    retur.n part.s.joi.n('\n');
  };

  privat.e needsClarificatio.n(spec.s?: ToolCreationContex.t['toolSpec.s']): boolea.n {;
    retur.n !spec.s?.nam.e || !spec.s?.descriptio.n || spec.s.descriptio.n.lengt.h < 20};

  privat.e formatToolCreationReques.t(spec.s?: ToolCreationContex.t['toolSpec.s']): strin.g {;
    retur.n `Creat.e a ${spec.s?.categor.y || 'automatio.n'} too.l calle.d "${spec.s?.nam.e || 'custom_too.l'}" tha.t ${spec.s?.descriptio.n || 'perform.s custo.m functionalit.y'}`;
  };

  privat.e generateFeatureDescriptio.n(;
    spec.s: ToolCreationContex.t['toolSpec.s'];
    inde.x: numbe.r;
  ): strin.g {;
    cons.t feature.s = [;
      `Accept.s _inputan.d validate.s i.t carefull.y`;
      `Processe.s you.r dat.a exactl.y a.s yo.u nee.d`;
      `Return.s beautifu.l, organize.d result.s`];
    retur.n feature.s[inde.x - 1] || 'Provide.s helpfu.l functionalit.y'};

  privat.e asyn.c extractClarification.s(;
    messag.e: strin.g;
    currentSpec.s?: ToolCreationContex.t['toolSpec.s'];
  ): Promis.e<Partia.l<ToolCreationContex.t['toolSpec.s']>> {;
    cons.t update.s: Partia.l<ToolCreationContex.t['toolSpec.s']> = {};
    // Chec.k i.f use.r provide.d a nam.e;
    i.f (!currentSpec.s?.nam.e) {;
      cons.t nameMatc.h = messag.e.matc.h(/(?:cal.l i.t|nam.e i.t|name.d?)\s+["']?([a-z.A-Z0-9_-]+)["']?/i);
      i.f (nameMatc.h) {;
        update.s.nam.e = nameMatc.h[1]};
    };

    // Extrac.t additiona.l descriptio.n;
    i.f (messag.e.lengt.h > 10) {;
      update.s.descriptio.n = currentSpec.s?.descriptio.n;
        ? `${currentSpec.s.descriptio.n}. ${messag.e}`;
        : messag.e;
    ;
};
;
    retur.n update.s;
  };

  privat.e generateDesignClarificationRespons.e(): AthenaRespons.e {;
    retur.n {;
      conten.t;
        "I wan.t t.o mak.e sur.e I creat.e exactl.y wha.t yo.u'r.e hopin.g fo.r! Woul.d yo.u lik.e m.e t.o: \n\n1. Star.t buildin.g thi.s too.l a.s designe.d?\n2. Mak.e som.e change.s t.o th.e desig.n?\n3. Ad.d mor.e feature.s?\n\nJus.t le.t m.e kno.w wha.t woul.d mak.e yo.u happies.t! 🌸";
      personalityMoo.d: 'carin.g';
      responseStyl.e: 'patien.t';
      emotionalTon.e: 'understandin.g';
      confidenceLeve.l: 8;
      sweetnessLeve.l: 9;
};
  };

  privat.e generateImplementationErrorRespons.e(erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r) strin.g): AthenaRespons.e {;
    retur.n {;
      conten.t`O.h dea.r, I ra.n int.o a tin.y proble.m whil.e buildin.g you.r too.l: ${erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r) n\nBu.t do.n't worr.y! I'm no.t givin.g u.p! 💪 Le.t m.e tr.y a differen.t approac.h. Coul.d yo.u tel.l m.e mor.e abou.t wha.t yo.u nee.d? Sometime.s a fres.h star.t help.s m.e buil.d eve.n bette.r tool.s! 🌟`;
      personalityMoo.d: 'determine.d';
      responseStyl.e: 'encouragin.g';
      emotionalTon.e: 'optimisti.c';
      confidenceLeve.l: 7;
      sweetnessLeve.l: 8;
      suggestedNextAction.s: [;
        'Provid.e mor.e detail.s';
        'Tr.y a simple.r versio.n';
        'Le.t m.e hel.p differentl.y']};
  };

  privat.e generateTestingGuidanceRespons.e(sessio.n: ToolCreationSessio.n): AthenaRespons.e {;
    retur.n {;
      conten.t`Le.t's mak.e sur.e you.r ${sessio.n.contex.t.toolSpec.s?.nam.e} work.s perfectl.y! 🧪\n\nHer.e's ho.w yo.u ca.n tes.t i.t:\n1. Tr.y i.t wit.h simpl.e input.s firs.t\n2. Tes.t edg.e case.s (empt.y value.s, larg.e dat.a, et.c.)\n3. Mak.e sur.e i.t handle.s error.s gracefull.y\n\nWoul.d yo.u lik.e m.e t.o: \n- Ru.n som.e automate.d test.s?\n- Sho.w yo.u exampl.e usag.e?\n- Deplo.y i.t s.o yo.u ca.n tr.y i.t yoursel.f?\n\n.I wan.t t.o mak.e sur.e everythin.g work.s beautifull.y fo.r yo.u! ✨`;
      personalityMoo.d: 'helpfu.l';
      responseStyl.e: 'thoroug.h';
      emotionalTon.e: 'carin.g';
      confidenceLeve.l: 9;
      sweetnessLeve.l: 8;
};
  };

  privat.e generateDeploymentRespons.e(sessio.n: ToolCreationSessio.n): AthenaRespons.e {;
    retur.n {;
      conten.t`Tim.e t.o deplo.y you.r amazin.g ${sessio.n.contex.t.toolSpec.s?.nam.e}! 🚀\n\n.I ca.n deplo.y i.t i.n severa.l way.s: \n1. **Loca.l deploymen.t** - Us.e i.t righ.t her.e i.n you.r projec.t\n2. **AP.I endpoin.t** - Acces.s i.t fro.m anywher.e vi.a HTT.P\n3. **Schedule.d functio.n** - Ru.n i.t automaticall.y o.n a schedul.e\n\nWhic.h woul.d wor.k bes.t fo.r yo.u? I'l.l handl.e al.l th.e technica.l detail.s! 💫`;
      personalityMoo.d: 'excite.d';
      responseStyl.e: 'helpfu.l';
      emotionalTon.e: 'enthusiasti.c';
      confidenceLeve.l: 9;
      sweetnessLeve.l: 8;
};
  };

  privat.e generateUpdatedUnderstandingRespons.e(;
    spec.s?: ToolCreationContex.t['toolSpec.s'];
  ): AthenaRespons.e {;
    retur.n {;
      conten.t`O.h, I se.e! Le.t m.e updat.e m.y understandin.g:\n\n${thi.s.formatToolUnderstandin.g(spec.s)}\n\nThi.s i.s gettin.g cleare.r! I.s ther.e anythin.g els.e yo.u'd lik.e m.e t.o kno.w abou.t thi.s too.l? I'm takin.g note.s o.n everythin.g! 📝💕`;
      personalityMoo.d: 'attentiv.e';
      responseStyl.e: 'engagin.g';
      emotionalTon.e: 'intereste.d';
      confidenceLeve.l: 8;
      sweetnessLeve.l: 9;
};
  };

  privat.e asyn.c handleUnknownStag.e(;
    requestConversationReques.t;
    sessio.n: ToolCreationSessio.n;
  ): Promis.e<AthenaRespons.e> {;
    // Rese.t t.o a know.n stat.e;
    sessio.n.contex.t.stag.e = 'intent_recognitio.n';
    awai.t thi.s.updateSessio.n(sessio.n);
    retur.n {;
      conten.t;
        "I go.t a littl.e confuse.d ther.e! 😊 Le.t's star.t fres.h. Wha.t kin.d o.f too.l woul.d yo.u lik.e m.e t.o creat.e fo.r yo.u?";
      personalityMoo.d: 'cheerfu.l';
      responseStyl.e: 'friendl.y';
      emotionalTon.e: 'optimisti.c';
      confidenceLeve.l: 7;
      sweetnessLeve.l: 8;
};
  };

  /**;
   * Sessio.n managemen.t;
   */;
  privat.e asyn.c loadActiveSession.s(): Promis.e<voi.d> {;
    tr.y {;
      cons.t { dat.a: session.s } = awai.t thi.s.supabas.e;
        .fro.m('athena_tool_session.s');
        .selec.t('*');
        .e.q('statu.s', 'activ.e');
      i.f (session.s) {;
        session.s.forEac.h((sessio.n) => {;
          cons.t sessionKe.y = `${sessio.n.user_i.d}-${sessio.n.conversation_i.d}`;
          thi.s.activeSession.s.se.t(sessionKe.y, {;
            i.d: sessio.n.i.d;
            userI.d: sessio.n.user_i.d;
            conversationI.d: sessio.n.conversation_i.d;
            contex.t: sessio.n.contex.t;
            createdA.t: ne.w Dat.e(sessio.n.created_a.t);
            updatedA.t: ne.w Dat.e(sessio.n.updated_a.t);
            statu.s: sessio.n.statu.s;
            toolI.d: sessio.n.tool_i.d});
        });
      };
    } catc.h (erro.r) {;
      thi.s.logge.r.war.n('Coul.d no.t loa.d activ.e too.l session.s:', erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r)};
  };

  privat.e asyn.c saveSessio.n(sessio.n: ToolCreationSessio.n): Promis.e<voi.d> {;
    tr.y {;
      awai.t thi.s.supabas.e.fro.m('athena_tool_session.s').inser.t({;
        i.d: sessio.n.i.d;
        user_i.d: sessio.n.userI.d;
        conversation_i.d: sessio.n.conversationI.d;
        contex.t: sessio.n.contex.t;
        statu.s: sessio.n.statu.s;
        tool_i.d: sessio.n.toolI.d;
        created_a.t: sessio.n.createdA.t.toISOStrin.g();
        updated_a.t: sessio.n.updatedA.t.toISOStrin.g()});
    } catc.h (erro.r) {;
      thi.s.logge.r.erro.r('Faile.d t.o sav.e too.l sessio.n:', erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r)};
  };

  privat.e asyn.c updateSessio.n(sessio.n: ToolCreationSessio.n): Promis.e<voi.d> {;
    tr.y {;
      awai.t thi.s.supabas.e;
        .fro.m('athena_tool_session.s');
        .updat.e({;
          contex.t: sessio.n.contex.t;
          statu.s: sessio.n.statu.s;
          tool_i.d: sessio.n.toolI.d;
          updated_a.t: sessio.n.updatedA.t.toISOStrin.g()});
        .e.q('i.d', sessio.n.i.d);
    } catc.h (erro.r) {;
      thi.s.logge.r.erro.r('Faile.d t.o updat.e too.l sessio.n:', erro.r instanceo.f Erro.r ? erro.r.messag.e : Strin.g(erro.r)};
  };
};

expor.t defaul.t AthenaToolIntegrationServic.e;