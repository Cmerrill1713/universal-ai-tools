# Kong Gateway Configuration
# Production-ready settings for Universal AI Tools

# Basic Settings
prefix = /usr/local/kong/
log_level = info
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl

# Database Configuration (PostgreSQL)
database = postgres
pg_host = postgres
pg_port = 5432
pg_database = kong
pg_user = kong
pg_password = kong

# SSL Configuration
ssl_cert = /etc/kong/ssl/kong.crt
ssl_cert_key = /etc/kong/ssl/kong.key
admin_ssl_cert = /etc/kong/ssl/admin.crt
admin_ssl_cert_key = /etc/kong/ssl/admin.key

# Performance Settings
worker_processes = auto
worker_connections = 1024
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60s

# Memory Settings
mem_cache_size = 128m
lua_shared_dict_size = 5m

# Logging
access_log = /dev/stdout
error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# Plugin Settings
plugins = bundled,prometheus,rate-limiting,cors,request-id,correlation-id,request-size-limiting

# Rate Limiting
rate_limiting_policy = local
rate_limiting_redis_host = redis
rate_limiting_redis_port = 6379
rate_limiting_redis_timeout = 2000

# Proxy Settings
proxy_buffer_size = 128k
proxy_buffers = 64 4k

# Timeouts
proxy_connect_timeout = 60s
proxy_send_timeout = 60s
proxy_read_timeout = 60s
upstream_keepalive_timeout = 60s

# Trust Settings
real_ip_header = X-Real-IP
real_ip_recursive = on
trusted_ips = 0.0.0.0/0,::/0

# Admin API
admin_gui_listen = 0.0.0.0:8002, 0.0.0.0:8445 ssl
admin_gui_url = http://localhost:8002

# Health Checks
upstream_keepalive_pool_size = 60
upstream_keepalive_max_requests = 100
upstream_keepalive_idle_timeout = 60s

# Security Headers
headers = off

# DNS Settings
dns_resolver = 8.8.8.8,8.8.4.4
dns_order = LAST,SRV,A,AAAA,CNAME

# Client Settings
client_body_buffer_size = 8k
client_header_buffer_size = 1k
large_client_header_buffers = 2 1k
client_max_body_size = 10m

# Status Server
status_listen = 0.0.0.0:8100

# Metrics
prometheus_metrics = on