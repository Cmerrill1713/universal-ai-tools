name: Close Stale Issues and PRs

on:
  schedule:
    - cron: '30 1 * * *'  # Run daily at 1:30 AM UTC
  workflow_dispatch:  # Allow manual trigger

permissions:
  issues: write
  pull-requests: write

jobs:
  stale:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
          # Issue configuration
          stale-issue-message: |
            üëã This issue has been automatically marked as stale because it has not had recent activity. 
            
            It will be closed in 7 days if no further activity occurs. If this issue is still relevant, please:
            - Comment with any updates
            - Add the `keep-open` label to prevent automatic closure
            
            Thank you for your contributions! üôè
          
          close-issue-message: |
            This issue has been automatically closed due to inactivity. 
            
            If you believe this was closed in error, please feel free to reopen it with additional context.
            
          stale-issue-label: 'stale'
          exempt-issue-labels: 'keep-open,pinned,security,bug,priority-high,in-progress'
          days-before-issue-stale: 30
          days-before-issue-close: 7
          
          # PR configuration
          stale-pr-message: |
            üëã This pull request has been automatically marked as stale because it has not had recent activity.
            
            It will be closed in 14 days if no further activity occurs. To keep this PR open:
            - Push new commits
            - Comment with updates
            - Add the `keep-open` label
            
            If this PR is waiting on review, please ping the maintainers.
            
          close-pr-message: |
            This pull request has been automatically closed due to inactivity.
            
            If you'd like to continue working on this, please:
            1. Reopen the PR
            2. Rebase on the latest main branch
            3. Address any merge conflicts
            
            Thank you for your contribution!
            
          stale-pr-label: 'stale'
          exempt-pr-labels: 'keep-open,work-in-progress,awaiting-review,dependencies'
          days-before-pr-stale: 14
          days-before-pr-close: 14
          
          # Processing limits
          operations-per-run: 30
          
          # Exempt all issues and PRs with these labels
          exempt-all-labels: 'keep-open,pinned'
          
          # Remove stale label when updated
          remove-stale-when-updated: true
          
          # Don't mark issues/PRs stale if they have assignees
          exempt-all-assignees: false
          
          # Process oldest first
          ascending: true
          
          # Enable debug logs
          debug-only: false